---
title: "Module 3 Theory â€” ADaM Programming in R"
format: html
editor: visual
---

# ğŸ§¬ Module 3 â€” ADaM Programming in R

## ğŸ¯ Learning Objectives

By the end of this module, you will:

-   Understand how to use pharmaverse packages for ADaM
-   Learn how to derive ADSL and BDS datasets (e.g., ADVS, ADAE)
-   Apply key functions from `admiral` to handle derivations and flags
-   Use Copilot to build mutate chains and ADaM derivation templates

------------------------------------------------------------------------

## ğŸ“¦ 1. Key Packages for ADaM Programming

| Package           | Purpose                 |
|-------------------|-------------------------|
| `pharmaversesdtm` | SDTM example datasets   |
| `pharmaverseadam` | ADaM example datasets   |
| `admiral`         | ADaM derivation toolkit |
| `dplyr`           | Core data manipulation  |
| `labelled`        | Assign variable labels  |

------------------------------------------------------------------------

## ğŸ“‹ 2. Create ADSL from SDTM

ADSL is the subject-level dataset. Typically built from SDTM domains like `DM`, `DS`, and `EX`.

``` r
library(admiral)
library(pharmaversesdtm)

# Load SDTM DM dataset
data(dm)

# Derive ADSL dataset
adsl <- dm %>%
  select(USUBJID, AGE, SEX, RACE, ARM, COUNTRY, RFSTDTC) %>%
  mutate(TRTFL = ifelse(ARM != "SCREEN FAILURE", "Y", "N"))
```

> ğŸ§  `mutate()` is used extensively for deriving analysis flags and core variables.

------------------------------------------------------------------------

## ğŸ“ˆ 3. Create ADaM BDS (ADVS Example)

ADaM BDS (Basic Data Structure) is commonly used for labs, vitals, AEs...

``` r
library(pharmaverseadam)

# Load ADVS example
data(advs)

# Filter and derive variables
advs_clean <- advs %>%
  filter(PARAMCD == "DIABP") %>%
  mutate(ASEVFL = ifelse(AVAL > 90, "Y", "N"))
```

> BDS requires variables like AVAL, AVALC, PARAMCD, AVISIT, ADT...

------------------------------------------------------------------------

## âš™ï¸ 4. Handling Imputations and Flags

Use `admiral` helper functions for date imputations and value derivations.

### Example: Derive Analysis Date (ADT) from SDTM

``` r
advs <- derive_vars_dt(
  dataset = advs,
  dtc = AESTDTC,
  new_vars_prefix = "AD"
)
```

### Example: Derive Character Version of AVAL

``` r
advs <- advs %>%
  mutate(AVALC = as.character(AVAL))
```

> Use `derive_vars_merged()` to merge reference info (e.g., from ADSL)

------------------------------------------------------------------------

## ğŸ” 5. Using Copilot for ADaM Automation

### Try the following Copilot prompts:

| Prompt Comment | Copilot Suggestion |
|----|----|
| `# Create ADSL dataset from DM` | `select(USUBJID, AGE, SEX, ...) %>% mutate(...)` |
| `# Derive ASEVFL for high diastolic BP` | `mutate(ASEVFL = ifelse(AVAL > 90, "Y", "N"))` |
| `# Derive AVALC from AVAL` | `mutate(AVALC = as.character(AVAL))` |
| `# Derive ADT from SDTM date` | `derive_vars_dt()` |

> Copilot helps build `mutate` pipelines and guides your usage of admiral functions.

------------------------------------------------------------------------

## ğŸ§  Summary

| Task                   | Function/Tool                              |
|------------------------|--------------------------------------------|
| Import SDTM data       | `pharmaversesdtm::dm`, `ds`, `ex`          |
| Build ADSL             | `select()`, `mutate()`, merge              |
| Build ADaM BDS         | `filter()`, `mutate()`, `AVAL`, `AVALC`    |
| Derive dates and flags | `derive_vars_dt()`, `derive_vars_merged()` |
| Use AI assistant       | GitHub Copilot                             |
