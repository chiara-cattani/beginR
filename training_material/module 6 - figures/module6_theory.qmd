---
title: "Module 6 Theory â€” TLF Figures"
format: html
editor: visual
---

# ðŸ“Š Module 6 â€” TLF Figures: Clinical Visualizations

## ðŸŽ¯ Learning Objectives

By the end of this module, you will:

-   Learn to create common clinical plots using `ggplot2`, `survminer`, and `patchwork`
-   Understand how to visualize lab values, adverse events, and survival curves
-   Learn to group plots by treatment arm or facet by visit
-   Use AI (Copilot) to accelerate plot creation

------------------------------------------------------------------------

## ðŸ§° 1. Key Packages

| Package     | Purpose                      |
|-------------|------------------------------|
| `ggplot2`   | Create custom plots          |
| `patchwork` | Combine multiple ggplots     |
| `survminer` | Kaplan-Meier survival curves |
| `dplyr`     | Data manipulation            |

------------------------------------------------------------------------

## ðŸ”¬ 2. Clinical Plot Examples

### A. Boxplot of Lab Values by Treatment Arm

```{r}
library(ggplot2)
library(dplyr)

labs <- tibble::tibble(
  VISIT = rep(c("Baseline", "Week 4"), each = 20),
  ARM = rep(c("Placebo", "Drug"), each = 10, times = 2),
  LAB_HGB = rnorm(40, mean = 13, sd = 1.5)
)

ggplot(labs, aes(x = ARM, y = LAB_HGB, fill = ARM)) +
  geom_boxplot() +
  facet_wrap(~VISIT) +
  theme_minimal() +
  labs(title = "Hemoglobin by Treatment and Visit", y = "HGB (g/dL)")
```

------------------------------------------------------------------------

### B. Bar Chart of AE Frequency

```{r}
aes <- tibble::tibble(
  AEDECOD = sample(c("NAUSEA", "HEADACHE", "FATIGUE"), 100, replace = TRUE),
  ARM = sample(c("Placebo", "Drug"), 100, replace = TRUE)
)

aes %>%
  count(AEDECOD, ARM) %>%
  ggplot(aes(x = AEDECOD, y = n, fill = ARM)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Adverse Events by Treatment", y = "Count")
```

------------------------------------------------------------------------

### C. Kaplan-Meier Survival Curve

```{r}
library(survival)
library(survminer)

surv_data <- tibble::tibble(
  time = sample(1:100, 50, replace = TRUE),
  status = sample(0:1, 50, replace = TRUE),
  ARM = rep(c("Placebo", "Drug"), each = 25)
)

fit <- survfit(Surv(time, status) ~ ARM, data = surv_data)

ggsurvplot(fit, data = surv_data, risk.table = TRUE, pval = TRUE,
           palette = c("#0072B2", "#D55E00"))
```

------------------------------------------------------------------------

## ðŸ¤– Copilot Prompt Ideas

| Prompt | Copilot Suggestion |
|----|----|
| `# ggplot boxplot by visit` | `ggplot() + geom_boxplot() + facet_wrap()` |
| `# bar chart of AE counts` | `geom_bar(stat = "identity")` |
| `# KM curve with survival data` | `survfit()` + `ggsurvplot()` |
| `# combine multiple plots` | Use `patchwork::wrap_plots()` |

------------------------------------------------------------------------

## âœ… Summary

| Visualization Type | Toolchain                 |
|--------------------|---------------------------|
| Boxplots           | `ggplot2 + facet_wrap()`  |
| Bar charts         | `ggplot2 + geom_bar()`    |
| KM curves          | `survival + survminer`    |
| Combine plots      | `patchwork::wrap_plots()` |
