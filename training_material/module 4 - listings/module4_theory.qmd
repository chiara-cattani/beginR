---
title: "Module 4 Theory â€” TLF Listings in R"
format: html
editor: visual
---

# ðŸ“„ Module 4 â€” TLF Listings in R

## ðŸŽ¯ Learning Objectives

By the end of this module, you will:

-   Understand what listings are and when they are used
-   Learn to build subject- and event-level listings in R
-   Apply conditional formatting and export to Word/HTML/PDF
-   Use Copilot to format and enhance table output

------------------------------------------------------------------------

## ðŸ“‹ 1. What is a Listing?

A listing is a subject-level or event-level table that displays detailed clinical data in tabular form.\
Listings are often used for: - Adverse Events (AE) - Subject Disposition - Concomitant Medications - Medical History

Unlike summary tables, listings display raw records row-by-row.

------------------------------------------------------------------------

## ðŸ“¦ 2. Key R Packages for Listings

| Package     | Purpose                             |
|-------------|-------------------------------------|
| `flextable` | Static tables for Word, PDF, HTML   |
| `gt`        | Elegant HTML tables with formatting |
| `reactable` | Interactive tables for web          |
| `officer`   | Export `flextable` tables to Word   |
| `gtsave`    | Export `gt` tables to HTML          |

------------------------------------------------------------------------

## ðŸ§ª 3. Create Subject-Level Listing with `flextable`

```{r}
library(flextable)

subject_data <- data.frame(
  USUBJID = c("01-001", "01-002", "01-003"),
  AGE = c(34, 65, 47),
  SEX = c("M", "F", "F"),
  COUNTRY = c("NL", "FR", "IT"),
  stringsAsFactors = FALSE
)

ft <- flextable(subject_data)
ft <- autofit(ft)
ft <- set_caption(ft, "Subject-Level Listing")

ft
```

------------------------------------------------------------------------

## ðŸ§ª 4. Create Event-Level Listing with `gt`

```{r}
library(gt)

ae_data <- data.frame(
  USUBJID = c("01-001", "01-002", "01-003"),
  AEDECOD = c("HEADACHE", "NAUSEA", "DIZZINESS"),
  AESEV = c("MILD", "MODERATE", "SEVERE"),
  stringsAsFactors = FALSE
)

gt_tbl <- gt(ae_data) %>%
  tab_header(title = "Adverse Events Listing") %>%
  data_color(
    columns = AESEV,
    colors = scales::col_factor(
      palette = c("MILD" = "lightgreen", "MODERATE" = "khaki", "SEVERE" = "lightcoral"),
      domain = NULL
    )
  )

gt_tbl
```

------------------------------------------------------------------------

## ðŸ§ª 5. Create Interactive Listing with `reactable`

```{r}
library(reactable)

reactable(subject_data, striped = TRUE, highlight = TRUE)
```

------------------------------------------------------------------------

## ðŸ“¤ 6. Exporting Tables

### Export flextable to Word

```{r eval=FALSE}
library(officer)

doc <- read_docx()
doc <- body_add_flextable(doc, ft)
print(doc, target = "output/subject_listing.docx")
```

### Export gt to HTML

```{r eval=FALSE}
gtsave(gt_tbl, filename = "output/ae_listing.html")
```

> `reactable` can be rendered in Quarto or Shiny apps interactively.

------------------------------------------------------------------------

## ðŸ¤– 7. Copilot Prompt Ideas

| Prompt | Copilot Suggestion |
|----|----|
| `# Create flextable from AE data` | Build a nicely formatted static table |
| `# Color AESEV column` | `data_color()` or conditional formatting |
| `# Export listing to Word` | `officer` pipeline |
| `# Create HTML table with title` | `gt() + tab_header()` |

------------------------------------------------------------------------

## âœ… Summary

| Task                      | R Tool / Package     |
|---------------------------|----------------------|
| Create static listings    | `flextable`          |
| Add colors and highlights | `gt`, `flextable`    |
| Create interactive tables | `reactable`          |
| Export to Word/HTML/PDF   | `officer`, `gtsave`  |
| Use Copilot to format     | Suggest table styles |
